<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="Less is more">
<meta property="og:type" content="website">
<meta property="og:title" content="HuYounger&#39;s Note">
<meta property="og:url" content="http://rkhcy.github.io/index.html">
<meta property="og:site_name" content="HuYounger&#39;s Note">
<meta property="og:description" content="Less is more">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HuYounger&#39;s Note">
<meta name="twitter:description" content="Less is more">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rkhcy.github.io/"/>





  <title>HuYounger's Note</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HuYounger's Note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/11/16/Dagger2从入门到补胎(二)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/16/Dagger2从入门到补胎(二)/" itemprop="url">Dagger2从入门到补胎(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-16T00:00:00+08:00">
                2017-11-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/11/16/Dagger2从入门到补胎(二)/" class="leancloud_visitors" data-flag-title="Dagger2从入门到补胎(二)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>继续学习在代码中会看到的标注：@Named、@Qualifier、@Singleton、@Scope。这四个标注包括之前学的@Inject其实不是在dagger的包中，而是javax-inject包中：</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger2_1_1.png" style="zoom:50%"></p>
<p>经过上篇的学习，结合@Inject、@Component、@Module、@Provides的使用，先看一个例子：</p>
<p>City.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class City &#123;</div><div class="line">    private String name;</div><div class="line"></div><div class="line">    public City() &#123;&#125;</div><div class="line"></div><div class="line">    public String show() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setName(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>BeanModule.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @Provides</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;成都&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Provides</div><div class="line">    City providerCityZG()&#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;自贡&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivityComponent.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Component(modules = BeanModule.class)</div><div class="line">public interface MainActivityComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    public static String TAG = &quot;hcy&quot;;</div><div class="line">    @Inject</div><div class="line">    City city;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        //in Android Studio, select Build &gt; Rebuild Project</div><div class="line">        DaggerMainActivityComponent.create().inject(this);</div><div class="line">        Log.d(TAG, &quot;city name: &quot; + city.show());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一跑起来就GG了</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger2_1_2.png" style="zoom:50%"></p>
<p>心路历程是这样的，MainActivity.java作为依赖需求方，编译生成MainActivity_MembersInjector，BeanModule.java作为依赖提供方，编译生成两个Xx_Factory，那么问题来了，有两个“备胎”供选择，你选谁？Component一脸懵逼，愣是搞不懂把哪两个”绑定”起来，直接罢工了，因此可以看到上篇中的DaggerMainActivityComponent在这里没有生成。</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger2_02_02.png" style="zoom:50%"></p>
<h3 id="Named"><a href="#Named" class="headerlink" title="@Named"></a>@Named</h3><p>那么告诉Component我们要的是哪个不就行啦？可以使用@Named标注，改下BeanModule.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;成都&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityZG() &#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;自贡&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    public static String TAG = &quot;hcy&quot;;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Inject</div><div class="line">    City city;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        //in Android Studio, select Build &gt; Rebuild Project</div><div class="line">        DaggerMainActivityComponent.create().inject(this);</div><div class="line">        Log.d(TAG, &quot;city name: &quot; + city.show());</div></pre></td></tr></table></figure>
<p>@Named(“参数”)和被引用的地方填的一致就可以了，编译运行就不会报错了。此时编译生成的文件：</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger2_02_03.png" style="zoom:50%"></p>
<p>熟悉的DaggerMainActivityComponent又回来了，而且两个依赖提供者也都在，通过打印我们知道选的是CD，那它是怎么实现的呢？看下DaggerMainActivityComponent的initialize()：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private void initialize(final Builder builder) &#123;</div><div class="line"></div><div class="line">    this.providerCityCDProvider = BeanModule_ProviderCityCDFactory.create(builder.beanModule);</div><div class="line"></div><div class="line">    this.mainActivityMembersInjector = MainActivity_MembersInjector.create(providerCityCDProvider);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>可以看到，依赖提供方和需求方通过@Named加了相同的标注CD后，在创建工厂的时候只会把CD这个提供方初始化，ZG根本没有露脸的机会，后面的流程就跟上篇一样了。</p>
<h3 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h3><p>使用@Qualifier可以实现@Named一样的功能，Qualifier翻译过来是修饰符的意思，先看下用法，再分析@Qualifier和@Named之间的“苟且”。添加一个接口CD.java和ZG.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Qualifier</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">public @interface CD &#123;&#125;</div><div class="line"></div><div class="line">@Qualifier</div><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">public @interface ZG &#123;&#125;</div></pre></td></tr></table></figure>
<p>修改BeanModule.java如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @CD</div><div class="line">    @Provides</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;成都&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @ZG</div><div class="line">    @Provides</div><div class="line">    City providerCityZG() &#123;</div><div class="line">        City city = new City();</div><div class="line">        city.setName(&quot;自贡&quot;);</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    public static String TAG = &quot;hcy&quot;;</div><div class="line">    @CD</div><div class="line">    @Inject</div><div class="line">    City city;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        //in Android Studio, select Build &gt; Rebuild Project</div><div class="line">        DaggerMainActivityComponent.create().inject(this);</div><div class="line">        Log.d(TAG, &quot;city name: &quot; + city.show());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>修改后和输出结果、编译生成的类以及源码都和@Named一毛一样。@Qualifier可以让我们自己创建限定符，其实@Named内部也是通过@Qualifier实现，源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * String-based &#123;@linkplain Qualifier qualifier&#125;.</div><div class="line"> *</div><div class="line"> * &lt;p&gt;Example usage:</div><div class="line"> *</div><div class="line"> * &lt;pre&gt;</div><div class="line"> *   public class Car &#123;</div><div class="line"> *     &amp;#064;Inject &lt;b&gt;@Named(&quot;driver&quot;)&lt;/b&gt; Seat driverSeat;</div><div class="line"> *     &amp;#064;Inject &lt;b&gt;@Named(&quot;passenger&quot;)&lt;/b&gt; Seat passengerSeat;</div><div class="line"> *     ...</div><div class="line"> *   &#125;&lt;/pre&gt;</div><div class="line"> */</div><div class="line">@Qualifier</div><div class="line">@Documented</div><div class="line">@Retention(RUNTIME)</div><div class="line">public @interface Named &#123;</div><div class="line"></div><div class="line">    /** The name. */</div><div class="line">    String value() default &quot;&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从注释可知@Named是@Qualifier的String型实现；看下<a href="https://github.com/codepath/android_guides/wiki/Dependency-Injection-with-Dagger-2" target="_blank" rel="external">github</a>上一张介绍图：</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger_qualifiers.png" style="zoom:100%"></p>
<p>顺便提一下这里的@Retention，翻译过来是保留的意思，它是用来指定我们自定义的限定符能保留的多久，有三种可选：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Indicates how long annotations with the annotated type are to</div><div class="line"> * be retained.  If no Retention annotation is present on</div><div class="line"> * an annotation type declaration, the retention policy defaults to</div><div class="line"> * &#123;@code RetentionPolicy.CLASS&#125;.</div><div class="line"> */</div><div class="line">public enum RetentionPolicy &#123;</div><div class="line">    /**</div><div class="line">     * Annotations are to be discarded by the compiler.</div><div class="line">     */</div><div class="line">    SOURCE,</div><div class="line"></div><div class="line">    /**</div><div class="line">     * Annotations are to be recorded in the class file by the compiler</div><div class="line">     * but need not be retained by the VM at run time.  This is the default</div><div class="line">     * behavior.</div><div class="line">     */</div><div class="line">    CLASS,</div><div class="line"></div><div class="line">    /**</div><div class="line">     * Annotations are to be recorded in the class file by the compiler and</div><div class="line">     * retained by the VM at run time, so they may be read reflectively.</div><div class="line">     *</div><div class="line">     * @see java.lang.reflect.AnnotatedElement</div><div class="line">     */</div><div class="line">    RUNTIME</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Singleton"><a href="#Singleton" class="headerlink" title="@Singleton"></a>@Singleton</h3><p>@Singleton从名字就知道是单例，怎么用这个？先看一个例子：</p>
<p>City.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public class City &#123;</div><div class="line">    public City() &#123;&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>BeanModule.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityZG() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivityComponent.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Component(modules = BeanModule.class)</div><div class="line">public interface MainActivityComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    public static String TAG = &quot;hcy&quot;;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Inject</div><div class="line">    City cityCD1;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Inject</div><div class="line">    City cityCD2;</div><div class="line"></div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Inject</div><div class="line">    City cityZG1;</div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Inject</div><div class="line">    City cityZG2;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        //in Android Studio, select Build &gt; Rebuild Project</div><div class="line">        DaggerMainActivityComponent.create().inject(this);</div><div class="line">        Log.d(TAG, &quot;cityCD1 is: &quot; + cityCD1);</div><div class="line">        Log.d(TAG, &quot;cityCD2 is: &quot; + cityCD2);</div><div class="line">        Log.d(TAG, &quot;cityZG1 is: &quot; + cityZG1);</div><div class="line">        Log.d(TAG, &quot;cityZG2 is: &quot; + cityZG2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>例子很简单，打印city如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">D/hcy     (13129): cityCD1 is: com.hcy.huchengyang.dagger2.bean.City@35051924</div><div class="line">D/hcy     (13129): cityCD2 is: com.hcy.huchengyang.dagger2.bean.City@36acdc8d</div><div class="line">D/hcy     (13129): cityZG1 is: com.hcy.huchengyang.dagger2.bean.City@14db0e42</div><div class="line">D/hcy     (13129): cityZG2 is: com.hcy.huchengyang.dagger2.bean.City@28a95e53</div></pre></td></tr></table></figure>
<p>可以看到这里获取到的对应4个不同的city，按照上一篇的分析套路可以很快定位到原因，查看编译生成的MainActivity_MembersInjector.java中的injectMembers()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">  public void injectMembers(MainActivity instance) &#123;</div><div class="line">    if (instance == null) &#123;</div><div class="line">      throw new NullPointerException(&quot;Cannot inject members into a null reference&quot;);</div><div class="line">    &#125;</div><div class="line">    instance.cityCD1 = cityCD1AndCityCD2Provider.get();</div><div class="line">    instance.cityCD2 = cityCD1AndCityCD2Provider.get();</div><div class="line">    instance.cityZG1 = cityZG1AndCityZG2Provider.get();</div><div class="line">    instance.cityZG2 = cityZG1AndCityZG2Provider.get();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这里会调用目标工厂的get方法，最后调用到BeanModule的方法创建对象；如果要确保单例，@Singleton就可以派上用场了。</p>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><p>1.在提供依赖的构造函数上加@Singleton</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Provides</div><div class="line">    @Singleton</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityZG() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.@Component标注的接口加上@Singleton</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Singleton</div><div class="line">@Component(modules = BeanModule.class)</div><div class="line">public interface MainActivityComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>修改后打印：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">D/hcy     (13519): cityCD1 is: com.hcy.huchengyang.dagger2.bean.City@35051924</div><div class="line">D/hcy     (13519): cityCD2 is: com.hcy.huchengyang.dagger2.bean.City@35051924</div><div class="line">D/hcy     (13519): cityZG1 is: com.hcy.huchengyang.dagger2.bean.City@36acdc8d</div><div class="line">D/hcy     (13519): cityZG2 is: com.hcy.huchengyang.dagger2.bean.City@14db0e42</div></pre></td></tr></table></figure>
<p>那么它是怎么保证单例的呢？查看源码会发现MainActivity_MembersInjector.java中的injectMembers()方法和之前是一样的，但是DaggerMainActivityComponent.java的initialize()方法发生了改变：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">private void initialize(final Builder builder) &#123;</div><div class="line"></div><div class="line">    this.providerCityCDProvider =</div><div class="line">        DoubleCheck.provider(BeanModule_ProviderCityCDFactory.create(builder.beanModule));</div><div class="line"></div><div class="line">    this.providerCityZGProvider = BeanModule_ProviderCityZGFactory.create(builder.beanModule);</div><div class="line"></div><div class="line">    this.mainActivityMembersInjector =</div><div class="line">        MainActivity_MembersInjector.create(providerCityCDProvider, providerCityZGProvider);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这里多了DoubleCheck的操作。看下DoubleCheck.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">public final class DoubleCheck&lt;T&gt; implements Provider&lt;T&gt;, Lazy&lt;T&gt; &#123;</div><div class="line">  private static final Object UNINITIALIZED = new Object();</div><div class="line"></div><div class="line">  private volatile Provider&lt;T&gt; provider;</div><div class="line">  private volatile Object instance = UNINITIALIZED;</div><div class="line"></div><div class="line">  private DoubleCheck(Provider&lt;T&gt; provider) &#123;</div><div class="line">    assert provider != null;</div><div class="line">    this.provider = provider;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  @Override</div><div class="line">  public T get() &#123;</div><div class="line">    Object result = instance;</div><div class="line">    if (result == UNINITIALIZED) &#123;//第一次取值后下次再来判断不满足直接返回之前的实例</div><div class="line">      synchronized (this) &#123;</div><div class="line">        result = instance;</div><div class="line">        if (result == UNINITIALIZED) &#123;</div><div class="line">          result = provider.get();</div><div class="line">          Object currentInstance = instance;</div><div class="line">          if (currentInstance != UNINITIALIZED &amp;&amp; currentInstance != result) &#123;</div><div class="line">            throw new IllegalStateException();</div><div class="line">          &#125;</div><div class="line">          instance = result;</div><div class="line"></div><div class="line">          provider = null;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    return (T) result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public static &lt;T&gt; Provider&lt;T&gt; provider(Provider&lt;T&gt; delegate) &#123;</div><div class="line">    checkNotNull(delegate);</div><div class="line">    if (delegate instanceof DoubleCheck) &#123;</div><div class="line">      return delegate;</div><div class="line">    &#125;</div><div class="line">    return new DoubleCheck&lt;T&gt;(delegate);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>整个类都没多少代码，省略了注释和异常以及部分代码，DoubleCheck和我们的Factory都实现了共有接口Provider，保证单例的操作就是这里的get()方法，注释已解释，可以跟着流程走一波。这里看下<a href="https://github.com/codepath/android_guides/wiki/Dependency-Injection-with-Dagger-2" target="_blank" rel="external">github</a>上的一张图，下图左边的对应没有标注@Singleton，每次取时都会重新new；右边有标注的在第一次创建时会缓存一份，下次再获取直接就返回缓存的。</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/dagger_scopes.png" style="zoom:100%"></p>
<h3 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h3><p>使用@Scope可以实现@Singleton一样的功能，Scope翻译过来是作用域的意思，其实@Singleton就是@Scope的实现(有点像上面@Named和@Qualifier的关系)，源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Scope</div><div class="line">@Documented</div><div class="line">@Retention(RUNTIME)</div><div class="line">public @interface Singleton &#123;&#125;</div></pre></td></tr></table></figure>
<p>我们可以完全可以自己定义一个接口如：MainActivityScope.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Scope</div><div class="line">@Documented</div><div class="line">@Retention(value= RetentionPolicy.RUNTIME)</div><div class="line">public @interface MainActivityScope&#123;&#125;</div></pre></td></tr></table></figure>
<p>修改MainActivityComponent.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@MainActivityScope</div><div class="line">@Component(modules = BeanModule.class)</div><div class="line">public interface MainActivityComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>修改BeanModule.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Module</div><div class="line">public class BeanModule &#123;</div><div class="line">    @Named(&quot;CD&quot;)</div><div class="line">    @Provides</div><div class="line">    @MainActivityScope</div><div class="line">    City providerCityCD() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Named(&quot;ZG&quot;)</div><div class="line">    @Provides</div><div class="line">    City providerCityZG() &#123;</div><div class="line">        City city = new City();</div><div class="line">        return city;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果是一样的，@Scope是成对使用的，在@Module的@Provides方法上使用@Scope标注，那么对应的@Component也需要@Scope标准，此时@Provides方法提供的依赖在@Component中为单例。</p>
<p>未完待续…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/11/15/Dagger2从入门到补胎(一)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/15/Dagger2从入门到补胎(一)/" itemprop="url">Dagger2从入门到补胎(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-15T00:00:00+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/11/15/Dagger2从入门到补胎(一)/" class="leancloud_visitors" data-flag-title="Dagger2从入门到补胎(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>最近公司的项目是用mvp+dagger2搭的框架，由于之前没接触过dagger2，改bug和做需求总是一脸懵逼，看了些文档介绍，和大多数学习者一样从Dependency Injection、注解概念等等开始了解，然后敲代码上手，在此记录下学习心得。既然是入门，那些概念和注解的历史就不介绍了，Google一下你就知道，直接介绍最最基本的使用以及具体实现原理。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/11/15/Dagger2从入门到补胎(一)/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/10/12/Java执行顺序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/12/Java执行顺序/" itemprop="url">Java执行顺序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-12T00:00:00+08:00">
                2017-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/10/12/Java执行顺序/" class="leancloud_visitors" data-flag-title="Java执行顺序">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>通过一个例子了解Java中子父类各方法执行顺序：</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/10/12/Java执行顺序/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/09/27/TransitionNote2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/27/TransitionNote2/" itemprop="url">Transition学习笔记2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-27T00:00:00+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/09/27/TransitionNote2/" class="leancloud_visitors" data-flag-title="Transition学习笔记2">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在<a href="http://rkhcy.github.io/2017/09/21/TransitionNote/">上篇</a>笔记中对于Transition的框架和常用的API使用进行了分析，Transition最常用的是在界面过渡方面，本文继续学习Transition在界面过渡上的使用。在界面过渡上，Transition分为不带共享元素的Content Transition和带共享元素的ShareElement Transition。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/27/TransitionNote2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/09/21/TransitionNote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/21/TransitionNote/" itemprop="url">Transition学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-21T00:00:00+08:00">
                2017-09-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/09/21/TransitionNote/" class="leancloud_visitors" data-flag-title="Transition学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Android 4.4.2 (API level 19)引入Transition框架，之后很多APP上都使用该框架做出很酷炫的效果，如 Google Play Newsstand app</p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/transition_app1.gif" style="zoom:75%"></p>
<p>还有github上很火的<a href="https://github.com/nickbutcher/plaid" target="_blank" rel="external">plaid</a></p>
<p><img src="http://7xjvg5.com1.z0.glb.clouddn.com/plaid_demo.gif" style="zoom:75%"></p>
<p>在app中适当得使用上Transition能带来较好的用户体验，<a href="https://www.youtube.com/watch?time_continue=1007&amp;v=S3H7nJ4QaD8" target="_blank" rel="external">视频</a>中介绍了该框架的基本使用以及其中核心的一些类和方法，只有学会这些基本的API才能在之后的Activity/Fragment过渡定制一些自己想要的效果。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/21/TransitionNote/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/09/18/TomatoView实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/18/TomatoView实现/" itemprop="url">TomatoView实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-18T00:00:00+08:00">
                2017-09-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/09/18/TomatoView实现/" class="leancloud_visitors" data-flag-title="TomatoView实现">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>最近跟着<a href="http://hencoder.com/" target="_blank" rel="external">扔物线</a>的自定义View教程重新复习了一波基础，但是API这种东西如果不用很容易就忘了，趁大脑还没触发GC之前，最好的记忆方式就是撸个Demo出来。iOS上有一款个人很喜欢的简约TODO应用叫极简待办，其中它的番茄时钟交互很适合用来练手。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/18/TomatoView实现/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/09/12/ViewStub学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/12/ViewStub学习/" itemprop="url">ViewStub学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-12T00:00:00+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/09/12/ViewStub学习/" class="leancloud_visitors" data-flag-title="ViewStub学习">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>一提到ViewStub，可能很多人就会想到布局性能优化，那么它具体是怎么实现的呢？</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/09/12/ViewStub学习/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/08/23/Java适配器模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/23/Java适配器模式/" itemprop="url">Java适配器模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-23T00:00:00+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/23/Java适配器模式/" class="leancloud_visitors" data-flag-title="Java适配器模式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>维基百科上的描述：</p>
<blockquote>
<p>In software engineering, the adapter pattern is a software design pattern that allows the interface of an existing class to be used as another interface. It is often used to make existing classes work with others without modifying their source code.</p>
</blockquote>
<p>简单理解就是适配器模式可以将一个对象进行包装，使得该对象与其他类兼容。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/23/Java适配器模式/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/07/07/PhysicsBasedAnimation学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/07/PhysicsBasedAnimation学习/" itemprop="url">PhysicsBasedAnimation学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T00:00:00+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/07/07/PhysicsBasedAnimation学习/" class="leancloud_visitors" data-flag-title="PhysicsBasedAnimation学习">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Google I/O ‘17推出了许多新的特性，在动画这一块又有新的API供开发者使用，具体视频请见<a href="https://www.youtube.com/watch?v=BNcODK-Ju0g" target="_blank" rel="external">Android Animations Spring to Life (Google I/O ‘17)</a>，主要介绍了Physics-based Animations，在动画API中引入了<code>DynamicAnimation</code>，并介绍了它的两个子类<code>FlingAnimation</code>和<code>SpringAnimation</code>的使用，开发者可以使用新的API创建更加动态化的动画。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/07/07/PhysicsBasedAnimation学习/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://rkhcy.github.io/2017/05/31/Android View绘制源码分析--Draw/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HuYounger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuYounger's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/31/Android View绘制源码分析--Draw/" itemprop="url">Android View绘制源码分析--Draw</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-31T00:00:00+08:00">
                2017-05-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/05/31/Android View绘制源码分析--Draw/" class="leancloud_visitors" data-flag-title="Android View绘制源码分析--Draw">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
<div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>上篇文章分析DecorView的绘制的layout流程，这篇文章继续分析DecorView绘制的第三个阶段，draw流程。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/31/Android View绘制源码分析--Draw/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
     
     <div>    
      
  </div>
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="http://7xjvg5.com1.z0.glb.clouddn.com/avatar.jpeg"
              alt="HuYounger" />
          
            <p class="site-author-name" itemprop="name">HuYounger</p>
            <p class="site-description motion-element" itemprop="description">Less is more</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Rkhcy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 &mdash; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HuYounger</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("rcy0CA7vKecGb0eQxcnHdO3i-gzGzoHsz", "N9PBf4dqgEeMJL7klXsAli0a");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
